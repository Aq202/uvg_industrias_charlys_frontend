import React, { useEffect } from 'react';
import PropTypes from 'prop-types';
import { scrollbarGray } from '@styles/scrollbar.module.css';
import useCount from '@hooks/useCount';
import styles from './OrderProgressBar.module.css';

/**
 * Barra de progreso de un pedido. Puede ser utilizado solo para mostrar el dato o también como
 * un input para seleccionar la fase.
 * @param stage Number. Número del 0-3 correspondiente al valor default de la fase a mostrar.
 * @param useAsInput bool. Indica si el input será o no utilizado como un input. En caso de ser
 * verdadero, al hacer click sobre una fase, esta es seleccionada.
 * @param onChange Func. Callback que devuelve el índice de la fase seleccionada 0-3. Notar que el
 * callback solo será activado cuando la prop useAsInput sea verdadera.
 * @returns
 */
function OrderProgressBar({ stage, useAsInput, onChange }) {
  const {
    count, setCount,
  } = useCount(-1, 0, 3);

  useEffect(() => {
    if (!(stage >= 0)) return null;
    const timeout = setTimeout(() => setCount(stage), 600);
    return () => { clearTimeout(timeout); };
  }, [stage]);

  useEffect(() => {
    if (!useAsInput || !onChange) return;
    onChange(count); // Llamar al callback y devolver indice de fase seleccionada
  }, [count]);

  const handleStageClick = (stageNumber) => {
    if (!useAsInput) return;
    setCount(stageNumber);
  };

  return (
    <div className={`${styles.container} ${scrollbarGray}`}>
      <div className={`${styles.orderProgressBar} ${useAsInput ? styles.clickable : ''}`}>
        <div
          className={`${styles.circle} ${count >= 0 ? styles.active : ''}`}
          onClick={() => handleStageClick(0)}
          onKeyUp={() => handleStageClick(0)}
          role="button"
          tabIndex={useAsInput && 0}
        >
          <svg className="" width="512" height="512" enableBackground="new 0 0 512 512" version="1.1" viewBox="0 0 24 24" xmlSpace="preserve" xmlns="http://www.w3.org/2000/svg">
            <g>
              <path className="" d="M12.1 19.58a1.746 1.746 0 0 1-.872-.234l-5.2-3a1.752 1.752 0 0 1-.64-2.391l.75-1.3A4.4 4.4 0 0 1 9.6 10.824a.235.235 0 0 0 .18-.313 4.4 4.4 0 0 1-.146-3.917l.75-1.3a1.754 1.754 0 0 1 2.39-.641l5.2 3a1.752 1.752 0 0 1 .64 2.391l-.75 1.3a4.4 4.4 0 0 1-3.464 1.832.233.233 0 0 0-.18.312 4.4 4.4 0 0 1 .146 3.918l-.75 1.3a1.75 1.75 0 0 1-1.516.874zm-.2-13.66a.25.25 0 0 0-.217.125l-.75 1.3a3.092 3.092 0 0 0 .23 2.585 1.737 1.737 0 0 1-1.377 2.384 3.093 3.093 0 0 0-2.353 1.093l-.75 1.3a.25.25 0 0 0 .091.342l5.2 3a.252.252 0 0 0 .341-.092l.75-1.3a3.092 3.092 0 0 0-.23-2.585 1.735 1.735 0 0 1 1.377-2.383 3.1 3.1 0 0 0 2.353-1.094l.75-1.3a.25.25 0 0 0-.091-.342l-5.2-3a.253.253 0 0 0-.124-.033z" data-original="#000000" />
              <path className="" d="M22 12.75a.75.75 0 0 1-.75-.75A9.25 9.25 0 0 0 5.459 5.459a9.427 9.427 0 0 0-.862.993.75.75 0 0 1-1.2-.9 11.235 11.235 0 0 1 1-1.15A10.75 10.75 0 0 1 22.75 12a.75.75 0 0 1-.75.75zM12 22.75A10.748 10.748 0 0 1 1.25 12a.75.75 0 0 1 1.5 0 9.25 9.25 0 0 0 15.791 6.541 9.331 9.331 0 0 0 .861-.992.751.751 0 0 1 1.2.9 11.087 11.087 0 0 1-1 1.151A10.684 10.684 0 0 1 12 22.75z" data-original="#000000" />
              <path className="" d="M20.485 21.235a.75.75 0 0 1-.75-.75v-2.078h-2.079a.75.75 0 0 1 0-1.5h2.829a.75.75 0 0 1 .75.75v2.828a.75.75 0 0 1-.75.75zM6.343 7.093H3.515a.75.75 0 0 1-.75-.75V3.515a.75.75 0 0 1 1.5 0v2.078h2.078a.75.75 0 0 1 0 1.5z" data-original="#000000" />
            </g>
          </svg>

          <span className={`${styles.stageName} ${count === 0 ? styles.current : ''}`}>Pronto a iniciar</span>
        </div>

        <div
          className={`${styles.circle} ${count >= 1 ? styles.active : ''}`}
          onClick={() => handleStageClick(1)}
          onKeyUp={() => handleStageClick(1)}
          role="button"
          tabIndex={useAsInput && 0}
        >
          <svg className="" enableBackground="new 0 0 512 512" version="1.1" viewBox="0 0 512 512" xmlSpace="preserve" xmlns="http://www.w3.org/2000/svg">
            <g>
              <path className="" d="m395.27 265.37c-5.169-5.17-12.042-8.017-19.353-8.017s-14.184 2.847-19.352 8.016c-5.169 5.17-8.017 12.043-8.017 19.353s2.847 14.183 8.017 19.353c5.335 5.335 12.344 8.003 19.352 8.003 7.009 0 14.017-2.668 19.352-8.003 5.169-5.17 8.017-12.043 8.017-19.353s-2.847-14.183-8.016-19.352zm-10.305 28.399c-4.99 4.991-13.107 4.991-18.096 0-2.417-2.417-3.748-5.63-3.748-9.047s1.331-6.631 3.749-9.048c2.417-2.417 5.63-3.748 9.047-3.748s6.631 1.331 9.048 3.749c2.417 2.417 3.748 5.63 3.748 9.047s-1.331 6.631-3.748 9.047zm10.304 43.524c-10.671-10.671-28.034-10.672-38.705 0-5.169 5.17-8.017 12.043-8.017 19.353 1e-3 7.31 2.848 14.184 8.018 19.354 5.335 5.335 12.344 8.003 19.352 8.003 7.009 0 14.017-2.668 19.352-8.003v-1e-3c5.169-5.169 8.017-12.043 8.017-19.353s-2.847-14.183-8.017-19.353zm-10.304 28.401c-4.988 4.991-13.106 4.989-18.095 1e-3a12.715 12.715 0 0 1-3.749-9.049 12.71 12.71 0 0 1 3.748-9.047 12.755 12.755 0 0 1 9.048-3.742c3.277 0 6.554 1.247 9.048 3.742a12.711 12.711 0 0 1 3.748 9.047 12.71 12.71 0 0 1-3.748 9.048z" data-original="#000000" />
              <path className="" d="M484.582 145.753c-15.118 0-27.418 12.3-27.418 27.417v34.816h-14.656c-.975-17.309-8.765-33.656-21.72-45.311-13.706-12.333-32.024-18.355-50.362-16.604v-8.702h.234c8.108 0 14.705-6.597 14.705-14.705v-50.48c0-8.108-6.597-14.704-14.705-14.704h-15.04c-8.108 0-14.705 6.596-14.705 14.704v50.481c0 8.108 6.597 14.705 14.705 14.705h.233v10.021l-23.607 2.15c-4.008.364-6.961 3.909-6.596 7.917s3.903 6.969 7.917 6.596l30.3-2.759.029-.003 7.29-.664.106-.01a51.431 51.431 0 0 1 39.749 12.891 51.42 51.42 0 0 1 17.003 38.171v190.959H320.012l12.997-73.023c2.776-15.32-.987-31.253-10.323-43.713-9.336-12.459-23.57-20.546-39.053-22.184-.05-.006-.101-.01-.151-.014L92.213 247.472l3.211-61.732 193.06-17.581a7.285 7.285 0 0 0 6.596-7.917c-.365-4.009-3.911-6.98-7.917-6.596l-190.974 17.39.072-1.393a15.18 15.18 0 0 0-4.134-11.194 15.183 15.183 0 0 0-10.964-4.71h-.074v-4.921c0-9.684-7.879-17.563-17.563-17.563-9.685 0-17.564 7.879-17.564 17.563v4.921h-1.95a15.177 15.177 0 0 0-10.964 4.71 15.18 15.18 0 0 0-4.134 11.194l2.94 56.54c.209 4.019 3.631 7.086 7.655 6.898a7.287 7.287 0 0 0 6.898-7.656l-2.94-56.54a.52.52 0 0 1 .149-.404c.161-.17.337-.17.395-.17h37.15a.52.52 0 0 1 .396.17.52.52 0 0 1 .149.404l-5.923 113.892a.546.546 0 0 1-.545.518H49.935a.546.546 0 0 1-.545-.518l-.613-11.799c-.209-4.019-3.649-7.098-7.655-6.898a7.287 7.287 0 0 0-6.898 7.656l.613 11.799c.246 4.743 2.666 8.866 6.254 11.46v17.647c0 9.296 5.933 17.231 14.21 20.223v38.054c0 4.025 3.262 7.287 7.287 7.287s7.287-3.262 7.287-7.287v-38.053c8.277-2.992 14.21-10.926 14.21-20.223v-17.647c3.588-2.594 6.007-6.718 6.253-11.46l1.118-21.503 190.716 16.185c11.606 1.248 21.85 7.078 28.852 16.423 7.017 9.364 9.732 20.862 7.642 32.398l-13.455 75.599H22.66C10.165 402.639 0 412.803 0 425.298v6.563c0 12.494 10.165 22.659 22.66 22.659h439.303c12.495 0 22.66-10.165 22.66-22.659v-6.563c0-12.494-10.165-22.659-22.66-22.659h-19.346V249.854h14.546v34.816c0 15.119 12.3 27.418 27.418 27.418 15.119 0 27.418-12.3 27.418-27.418V173.171c.001-15.118-12.299-27.418-27.417-27.418zM355.62 122.797a.132.132 0 0 1-.132-.132V72.184c0-.072.059-.131.132-.131h15.04c.073 0 .132.059.132.131v50.481a.132.132 0 0 1-.132.132h-15.04zM66.516 153.74h-5.981v-4.921a2.994 2.994 0 0 1 2.991-2.99 2.994 2.994 0 0 1 2.99 2.99v4.921zm2.995 158.903a6.93 6.93 0 0 1-6.924 6.923 6.93 6.93 0 0 1-6.923-6.923V297.87h13.847v14.773zm392.452 104.569c4.459 0 8.087 3.627 8.087 8.086v6.563c0 4.459-3.628 8.086-8.087 8.086H22.66c-4.459 0-8.087-3.627-8.087-8.086v-6.563c0-4.459 3.628-8.086 8.087-8.086h439.303zm-4.799-181.931h-14.546V222.56h14.546v12.721zm40.263 49.389c0 7.083-5.762 12.845-12.845 12.845s-12.845-5.763-12.845-12.845V173.171c0-7.083 5.762-12.844 12.845-12.844s12.845 5.762 12.845 12.844V284.67z" data-original="#000000" />
            </g>
          </svg>

          <span className={`${styles.stageName} ${count === 1 ? styles.current : ''}`}>En producción</span>
        </div>

        <div
          className={`${styles.circle} ${count >= 2 ? styles.active : ''}`}
          onClick={() => handleStageClick(2)}
          onKeyUp={() => handleStageClick(2)}
          role="button"
          tabIndex={useAsInput && 0}
        >
          <svg className="" enableBackground="new 0 0 512 512" version="1.1" viewBox="0 0 512 512" xmlSpace="preserve" xmlns="http://www.w3.org/2000/svg"><path className="" d="m260.248 473.786 170.667-74.1a10.669 10.669 0 0 0 6.417-9.786V280.827l46.917-20.371c5.404-2.347 7.883-8.63 5.536-14.034a10.677 10.677 0 0 0-1.562-2.547h.001l-47.7-57.74 47.667-57.2c3.773-4.52 3.167-11.243-1.354-15.016a10.667 10.667 0 0 0-2.589-1.596l-170.667-74.1a10.644 10.644 0 0 0-12.443 2.956L256 95.341l-45.141-54.167a10.655 10.655 0 0 0-12.443-2.956L27.75 112.323c-5.402 2.343-7.882 8.621-5.539 14.023.405.935.943 1.807 1.596 2.589l47.667 57.2-47.7 57.74c-3.753 4.542-3.114 11.266 1.427 15.019a10.69 10.69 0 0 0 2.547 1.562l46.917 20.371V389.9c0 4.249 2.52 8.093 6.417 9.786l170.667 74.1c.884.344 2.299.772 4.081.798a11.73 11.73 0 0 0 4.418-.798zm52.163-412.817 150.276 65.25-39.1 46.922-150.276-65.25zm87.473 125.138L256 248.582l-143.884-62.475L256 123.63zM199.589 60.969l39.1 46.922-150.278 65.25-39.1-46.922zM88.447 199.088l150.3 65.261-39.19 47.445-150.3-65.263zm7.553 91 102.417 44.47a10.675 10.675 0 0 0 12.474-2.995l34.443-41.695v157.873L96 382.9zM416 382.9l-149.333 64.841V289.87l34.443 41.695a10.675 10.675 0 0 0 12.474 2.995L416 290.09zm-103.552-71.106-39.19-47.445 150.3-65.261 39.191 47.443z" data-original="#000000" /></svg>

          <span className={`${styles.stageName} ${count === 2 ? styles.current : ''}`}>Planchado y empaque</span>

        </div>

        <div
          className={`${styles.circle} ${count >= 3 ? styles.active : ''}`}
          onClick={() => handleStageClick(3)}
          onKeyUp={() => handleStageClick(3)}
          role="button"
          tabIndex={useAsInput && 0}
        >
          <svg className="" enableBackground="new 0 0 512 512" version="1.1" viewBox="0 0 512 512" xmlSpace="preserve" xmlns="http://www.w3.org/2000/svg">
            <g>
              <path className="" d="m476.158 231.363-13.259-53.035c3.625-.77 6.345-3.986 6.345-7.839v-8.551c0-18.566-15.105-33.67-33.67-33.67h-60.392V110.63c0-9.136-7.432-16.568-16.568-16.568H50.772c-9.136 0-16.568 7.432-16.568 16.568V256a8.017 8.017 0 0 0 16.034 0V110.63c0-.295.239-.534.534-.534h307.841c.295 0 .534.239.534.534v145.372a8.017 8.017 0 0 0 16.034 0v-9.088h94.569l.021.002.022-.001c11.637.008 21.518 7.646 24.912 18.171h-24.928a8.017 8.017 0 0 0-8.017 8.017v17.102c0 13.851 11.268 25.119 25.119 25.119h9.086v35.273h-20.962c-6.886-19.883-25.787-34.205-47.982-34.205s-41.097 14.322-47.982 34.205h-3.86v-60.393a8.017 8.017 0 0 0-16.034 0v60.391H192.817c-6.886-19.883-25.787-34.205-47.982-34.205s-41.097 14.322-47.982 34.205H50.772a.534.534 0 0 1-.534-.534v-17.637h34.739a8.017 8.017 0 0 0 0-16.034H8.017a8.017 8.017 0 0 0 0 16.034h26.188v17.637c0 9.136 7.432 16.568 16.568 16.568h43.304c-.002.178-.014.355-.014.534 0 27.996 22.777 50.772 50.772 50.772s50.772-22.776 50.772-50.772c0-.18-.012-.356-.014-.534h180.67c-.002.178-.014.355-.014.534 0 27.996 22.777 50.772 50.772 50.772 27.995 0 50.772-22.776 50.772-50.772 0-.18-.012-.356-.014-.534h26.203a8.017 8.017 0 0 0 8.017-8.017v-85.511c.001-21.112-15.576-38.653-35.841-41.738zm-100.976-87.062h60.392c9.725 0 17.637 7.912 17.637 17.637v.534h-78.029v-18.171zm0 86.58v-52.376h71.235l13.094 52.376h-84.329zM144.835 401.904c-19.155 0-34.739-15.583-34.739-34.739s15.584-34.739 34.739-34.739c19.155 0 34.739 15.583 34.739 34.739s-15.584 34.739-34.739 34.739zm282.188 0c-19.155 0-34.739-15.583-34.739-34.739s15.584-34.739 34.739-34.739c19.155 0 34.739 15.583 34.739 34.739s-15.584 34.739-34.739 34.739zm68.944-102.614h-9.086c-5.01 0-9.086-4.076-9.086-9.086v-9.086h18.171v18.172z" data-original="#000000" />
              <path className="" d="m144.84 350.6c-9.136 0-16.568 7.432-16.568 16.568s7.432 16.568 16.568 16.568 16.568-7.432 16.568-16.568-7.432-16.568-16.568-16.568zm282.19 0c-9.136 0-16.568 7.432-16.568 16.568s7.432 16.568 16.568 16.568 16.568-7.432 16.568-16.568-7.432-16.568-16.568-16.568zm-94.063-34.204h-119.72a8.017 8.017 0 0 0 0 16.034h119.72a8.017 8.017 0 0 0 0-16.034zm-205.23-34.205h-102.61a8.017 8.017 0 0 0 0 16.034h102.61a8.017 8.017 0 0 0 0-16.034zm151.04-108.82a8.017 8.017 0 0 0-11.337 1e-3l-71.292 71.291-37.087-37.087a8.016 8.016 0 0 0-11.337 0 8.016 8.016 0 0 0 0 11.337l42.756 42.756c1.565 1.566 3.617 2.348 5.668 2.348s4.104-0.782 5.668-2.348l76.96-76.96a8.018 8.018 0 0 0 1e-3 -11.338z" data-original="#000000" />
            </g>
          </svg>

          <span className={`${styles.stageName} ${count === 3 ? styles.current : ''}`}>Listo para entrega</span>
        </div>

        <div className={styles.progressBarContainer}>
          <div className={styles.progressBar}>
            <div className={styles.indicator} style={{ width: count > 0 ? `${count * 33}%` : 0 }} />
          </div>
        </div>
      </div>

    </div>
  );
}

export default OrderProgressBar;

OrderProgressBar.propTypes = {
  stage: PropTypes.number,
  useAsInput: PropTypes.bool,
  onChange: PropTypes.func,
};

OrderProgressBar.defaultProps = {
  stage: 0,
  useAsInput: true,
  onChange: null,
};
